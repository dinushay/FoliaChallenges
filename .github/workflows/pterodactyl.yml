- name: Upload to Pterodactyl via API
      env:
        PTERO_URL: ${{ secrets.PTERO_URL }}
        API_KEY: ${{ secrets.PTERO_API_KEY }}
        SERVER_ID: ${{ secrets.PTERO_SERVER_ID }}
        FILE_PATH: 'app/build/libs/FoliaChallenges.jar'
        TARGET_DIR: '/plugins'
      run: |
        RESPONSE=$(curl -s -v "${PTERO_URL}/api/client/servers/${SERVER_ID}/files/upload?directory=${TARGET_DIR}" \
          -H "Authorization: Bearer ${API_KEY}" \
          -H "Content-Type: application/json" \
          -H "Accept: application/json" \
          -H "User-Agent: GitHub-Actions-Deploy/1.0")

        echo "--- ANTWORT VOM SERVER ---"
        echo "$RESPONSE"
        echo "--------------------------"

        UPLOAD_URL=$(echo "$RESPONSE" | jq -r .attributes.url)

        if [ "$UPLOAD_URL" == "null" ] || [ -z "$UPLOAD_URL" ]; then
          echo "FEHLER: Konnte keine Upload-URL finden. Siehe Server-Antwort oben."
          exit 1
        fi

        echo "Upload URL erhalten: $UPLOAD_URL"
        echo "Starte Upload..."
        
        curl -X POST "${UPLOAD_URL}" \
          -F "files=@${FILE_PATH}" \
          -H "User-Agent: GitHub-Actions-Deploy/1.0"
          
        echo "Upload abgeschlossen."
